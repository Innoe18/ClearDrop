{% extends "base.html" %}
{% block content %}
<h2>Telemetry Logs</h2>

<form method="get" style="display:flex; gap:10px; align-items:end; flex-wrap:wrap;">
  <div>
    <label>Device</label><br>
    <select name="device_id">
      {% for d in devices %}
        <option value="{{ d.device_id }}" {% if d.device_id == selected_device %}selected{% endif %}>
          {{ d.nickname or d.device_id }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label>Limit</label><br>
    <input name="limit" type="number" value="{{ limit }}" min="10" max="1000">
  </div>

  <button type="submit">Apply</button>
</form>

<div style="margin-top:16px;">
  <table border="1" cellpadding="8" cellspacing="0">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Device</th>
        <th>Temp (Â°C)</th>
        <th>TDS (ppm)</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.ts }}</td>
        <td>{{ r.device_id }}</td>
        <td>{{ "%.1f"|format(r.temp_c) }}</td>
        <td>{{ r.tds_ppm }}</td>
      </tr>
      {% endfor %}
      {% if rows|length == 0 %}
      <tr><td colspan="4">No data yet.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
